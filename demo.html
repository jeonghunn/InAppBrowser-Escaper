<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InAppBrowserEscaper Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .demo-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056CC;
        }
        .button.secondary {
            background: #34C759;
        }
        .button.secondary:hover {
            background: #28A745;
        }
        .button.tertiary {
            background: #FF9500;
        }
        .button.tertiary:hover {
            background: #E6850E;
        }
        .scheme-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin: 10px 0;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        #test-results {
            margin-top: 15px;
        }
        .warning {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .simulation-tip {
            margin-top: 15px;
        }
        .simulation-tip p {
            margin-bottom: 10px;
        }
        .simulation-tip button {
            margin: 0;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üåê InAppBrowserEscaper Demo</h1>

    <div class="info">
        <h3>Current Browser Status</h3>
        <p id="browser-info">Loading...</p>
    </div>

    <div class="demo-section">
        <h2>üîß Test Controls</h2>
        <p>Use these buttons to test different scenarios:</p>

        <div class="test-grid">
            <button type="button" class="button" onclick="testBasicEscape()">
                Show Basic Escape Modal
            </button>

            <button type="button" class="button" onclick="testCustomEscape()">
                Show Custom Escape Modal
            </button>

            <button type="button" class="button" onclick="testAutoRedirect()">
                Test Auto Redirect
            </button>

            <button type="button" class="button secondary" onclick="testForceEscape()">
                üöÄ Test Force Escape
            </button>

            <button type="button" class="button" onclick="testCopyUrl()">
                Copy URL to Clipboard
            </button>
        </div>
    </div>

    <div class="demo-section">
        <h2>üì± Simulate Different In-App Browsers</h2>
        <p>Test the library with different simulated in-app browsers:</p>

        <div class="test-grid">
            <button type="button" class="button" onclick="simulateInstagram()">
                üì∑ Instagram Browser
            </button>

            <button type="button" class="button" onclick="simulateFacebook()">
                üë• Facebook Browser
            </button>

            <button type="button" class="button" onclick="simulateTwitter()">
                üê¶ Twitter/X Browser
            </button>

            <button type="button" class="button" onclick="resetUserAgent()">
                üîÑ Reset to Normal Browser
            </button>
        </div>
    </div>

    <div class="demo-section">
        <h2>üìä Detection Results</h2>
        <div id="detection-results"></div>
        <div id="test-results"></div>
    </div>

    <div class="demo-section">
        <h2>üîç Real Device Testing</h2>
        <div class="warning">
            <strong>For comprehensive testing:</strong>
            <ol>
                <li><strong>iOS Testing:</strong> Share this page to Instagram and Facebook on iPhone/iPad</li>
                <li><strong>Android Testing:</strong> Open the shared link within social media apps</li>
                <li><strong>Force Escape:</strong> Try the "üöÄ Force Escape" button</li>
                <li><strong>Monitor Results:</strong> Check console logs for detailed strategy information</li>
            </ol>
        </div>
    </div>

    <div class="demo-section">
        <h2>üíª Code Examples</h2>

        <h3>Basic Usage:</h3>
        <pre><code>import InAppBrowserEscaper, { InAppBrowserDetector } from '@jhrunning/inappbrowserescaper';

// Check if user is in an in-app browser
if (InAppBrowserDetector.isInAppBrowser()) {
  // Escape the in-app browser
  InAppBrowserEscaper.escape();
}</code></pre>

        <h3>Custom Options:</h3>
        <pre><code>InAppBrowserEscaper.escape({
  message: 'For the best experience, please open this in your browser',
  buttonText: 'Open in Browser',
  showModal: true
});</code></pre>

        <h3>Auto-redirect (default behavior):</h3>
        <pre><code>const browserInfo = InAppBrowserDetector.analyze();
if (browserInfo.appName === 'instagram') {
  // Calling escape() without showModal will auto-redirect
  InAppBrowserEscaper.escape();
}</code></pre>

        <h3>Using fallbackUrl:</h3>
        <pre><code>// Redirect to a specific URL instead of current page
InAppBrowserEscaper.escape({
  fallbackUrl: 'https://jhrun.com',
  showModal: true,
  buttonText: 'Continue to Site'
});

// Auto-redirect to app store or landing page
InAppBrowserEscaper.escape({
  fallbackUrl: 'https://apps.apple.com/app/your-app',
  message: 'Get the best experience with our mobile app!'
  // showModal: false is default, so it will auto-redirect
});</code></pre>
    </div>

    <!-- Include the built library -->
    <script src="./dist/browser/inappbrowserescaper.js"></script>

    <script>
        // Initialize demo
        let originalUserAgent = navigator.userAgent;
        
        // Access the library from the global scope
        const { InAppBrowserDetector, InAppBrowserEscaper } = window.InAppBrowserEscaper;
        
        function updateBrowserInfo() {
            const info = InAppBrowserDetector.analyze();
            const infoElement = document.getElementById('browser-info');
            
            let statusHtml = `
                <strong>Is In-App Browser:</strong> ${info.isInApp ? '‚úÖ Yes' : '‚ùå No'}<br>
                <strong>Platform:</strong> ${info.platform}<br>
                <strong>App Name:</strong> ${info.appName || 'N/A'}<br>
                <strong>User Agent:</strong> <code style="font-size: 12px;">${info.userAgent}</code>
            `;
            
            // Add simulate button if not in an in-app browser
            if (!info.isInApp) {
                statusHtml += `
                    <div class="simulation-tip">
                        <p><strong>üí° Tip:</strong> Simulate an in-app browser first for a better demo experience!</p>
                        <button type="button" class="button secondary" onclick="simulateInstagram()">
                            üì± Simulate In-App Browser
                        </button>
                    </div>
                `;
            }
            
            infoElement.innerHTML = statusHtml;
            updateDetectionResults(info);
        }
        
        function updateDetectionResults(info) {
            const resultsElement = document.getElementById('detection-results');
            
            const patterns = {
                instagram: /instagram/i,
                facebook: /FBAN|FBAV|FB_IAB/i,
                twitter: /TwitterAndroid|Twitter for iPhone/i,
                telegram: /TelegramBot/i,
                whatsapp: /WhatsApp/i,
                snapchat: /Snapchat/i,
                tiktok: /musical_ly|TikTok/i,
                linkedin: /LinkedInApp/i,
                wechat: /MicroMessenger/i
            };
            
            let resultsHtml = '<h3>Pattern Matching Results:</h3>';
            for (const [app, pattern] of Object.entries(patterns)) {
                const matches = pattern.test(navigator.userAgent);
                resultsHtml += `<div style="margin: 5px 0;">
                    <strong>${app}:</strong> ${matches ? '‚úÖ Match' : '‚ùå No Match'}
                </div>`;
            }
            
            resultsElement.innerHTML = resultsHtml;
        }
        
        function testBasicEscape() {
            const url = 'https://jhrun.com';
            addTestResult(`üß™ Testing basic escape with URL: ${url}`);
            InAppBrowserEscaper.escape({
                fallbackUrl: url,
                showModal: true,
            });
        }
        
        function testCustomEscape() {
            InAppBrowserEscaper.escape({
                message: 'üõçÔ∏è For secure checkout and the best shopping experience, please open this in your browser',
                buttonText: 'üîí Shop Securely',
                showModal: true,
                fallbackUrl: 'https://jhrun.com'
            });
        }
        
        function testAutoRedirect() {
            if (InAppBrowserDetector.isInAppBrowser()) {
                InAppBrowserEscaper.escape({
                    fallbackUrl: 'https://jhrun.com'
                });
                addTestResult('Auto-redirect attempted with enhanced strategies');
            } else {
                alert('Auto-redirect only works in in-app browsers. Try simulating an in-app browser first.');
            }
        }
        
        function testForceEscape() {
            addTestResult('üöÄ Testing force escape with quick instructions...');
            InAppBrowserEscaper.escape({ 
                force: true, 
                showQuickInstructions: true,
                fallbackUrl: 'https://jhrun.com' 
            });
            addTestResult('Force escape completed - check console for strategy details');
        }
        
        function testSafariHttpsScheme() {
            const url = 'https://jhrun.com';
            const schemeUrl = url.replace(/^https:\/\//, 'x-safari-https://');
            addTestResult(`Testing: ${schemeUrl}`);
            setTimeout(() => {
                window.location.href = schemeUrl;
            }, 1000);
        }
        
        function testSafariHttpScheme() {
            const url = 'http://jhrun.com';
            const schemeUrl = url.replace(/^http:\/\//, 'x-safari-http://');
            addTestResult(`Testing: ${schemeUrl}`);
            setTimeout(() => {
                window.location.href = schemeUrl;
            }, 1000);
        }
        
        async function testCopyUrl() {
            const success = await InAppBrowserEscaper.copyUrlToClipboard();
            if (success) {
                showMessage('‚úÖ URL copied to clipboard!', 'success');
            } else {
                showMessage('‚ùå Failed to copy URL', 'warning');
            }
        }
        
        function simulateInstagram() {
            // Override the userAgent temporarily for testing
            Object.defineProperty(navigator, 'userAgent', {
                value: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 Instagram 200.0.0.28.127',
                configurable: true
            });
            updateBrowserInfo();
            showMessage('üì± Simulating Instagram in-app browser on iOS', 'info');
            addTestResult('üì∑ Instagram browser simulation activated');
        }
        
        function simulateFacebook() {
            Object.defineProperty(navigator, 'userAgent', {
                value: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 [FBAN/FBIOS;FBDV/iPhone13,2;FBMD/iPhone;FBSN/iOS;FBSV/15.0;FBSS/3;FBID/phone;FBLC/en_US;FBOP/5]',
                configurable: true
            });
            updateBrowserInfo();
            showMessage('üì± Simulating Facebook in-app browser on iOS', 'info');
            addTestResult('üë• Facebook browser simulation activated');
        }
        
        function simulateTikTok() {
            Object.defineProperty(navigator, 'userAgent', {
                value: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 musical_ly_2021',
                configurable: true
            });
            updateBrowserInfo();
            showMessage('üì± Simulating TikTok in-app browser on iOS', 'info');
            addTestResult('üéµ TikTok browser simulation activated');
        }
        
        function simulateTwitter() {
            Object.defineProperty(navigator, 'userAgent', {
                value: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 Twitter for iPhone',
                configurable: true
            });
            updateBrowserInfo();
            showMessage('üì± Simulating Twitter in-app browser on iOS', 'info');
            addTestResult('üê¶ Twitter browser simulation activated');
        }
        
        function resetUserAgent() {
            Object.defineProperty(navigator, 'userAgent', {
                value: originalUserAgent,
                configurable: true
            });
            updateBrowserInfo();
            showMessage('üîÑ Reset to normal browser', 'info');
            addTestResult('üîÑ Browser reset to normal state');
        }
        
        function addTestResult(message, success = true) {
            const resultsEl = document.getElementById('test-results');
            if (!resultsEl) return;
            
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = `
                padding: 8px 12px;
                margin: 5px 0;
                border-radius: 4px;
                background: ${success ? '#e8f5e8' : '#ffe8e8'};
                border-left: 4px solid ${success ? '#4caf50' : '#f44336'};
                font-size: 14px;
            `;
            resultDiv.innerHTML = `${success ? '‚úÖ' : '‚ùå'} ${message} <small>(${new Date().toLocaleTimeString()})</small>`;
            resultsEl.appendChild(resultDiv);
            resultsEl.scrollTop = resultsEl.scrollHeight;
        }
        
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '999999';
            messageDiv.style.maxWidth = '300px';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // Auto-detection on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateBrowserInfo();
            addTestResult('üåê InAppBrowserEscaper Demo loaded successfully');
            
            // Show platform and capabilities info
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isInApp = InAppBrowserDetector.isInAppBrowser();
            
            addTestResult(`Platform: ${isIOS ? 'iOS ‚úÖ' : 'Other'}, In-App Browser: ${isInApp ? 'Yes ‚úÖ' : 'No'}`);
            
            if (isIOS) {
                addTestResult('‚úÖ Safari URL schemes available - try the orange buttons!');
            } else {
                addTestResult('‚ö†Ô∏è Safari URL schemes work best on iOS devices');
            }
            
            // Auto-show escape modal if actually in in-app browser
            if (isInApp) {
                setTimeout(() => {
                    InAppBrowserEscaper.escape({
                        message: 'üéâ Welcome to the InAppBrowserEscaper demo! You\'re currently in an in-app browser. This modal demonstrates the enhanced escape functionality with multiple Safari URL schemes.',
                        buttonText: 'üöÄ Open in Browser',
                        fallbackUrl: 'https://jhrun.com',
                        showModal: true
                    });
                    addTestResult('üéâ Auto-showed escape modal for in-app browser');
                }, 1500);
            }
        });
    </script>
</body>
</html>
